---
import type { AstroInstance } from "astro";
import { z } from "astro:content";

import Layout from "../layouts/Layout.astro";
import Card from "../components/Card.astro";

const patternSchema = z.object({
  title: z.string(),
  description: z.string().optional(),
  date: z.string().optional(),
  dateUpdated: z.string().optional(),
  isDraft: z.boolean().default(false),
});

// I wonder if we can sort these?
interface PatternProps extends AstroInstance {
  meta: typeof patternSchema;
}

const posts = await Astro.glob<PatternProps>("../pages/patterns/*.astro");

posts.map((p) => {
  console.log("meta is ", p?.meta || "");
  console.log("parse is ", patternSchema.safeParse(p?.meta || ""));
  console.log(p.meta?.description);
  console.log(p.meta?.date);
  // TODO: why am I getthing a type error when accesing isDraft but not description?
  console.log(p.meta?.isDraft);
});
---

<Layout title="Shape Playground">
  <main class="flex flex-col">
    <div class="self-center text-5xl">
      <ul role="list" class="m-5 flex-row p-3">
        {
          posts.map((post) => (
            <Card
              href={post.url || ""}
              title={post.file
                .split("/")
                .slice(-1)[0]
                .replace(".astro", "")
                .replace(/-/g, " ")}
              body={post.meta?.description || ""}
              isDraft={post.meta?.isDraft || false}
            />
          ))
        }
      </ul>
    </div>
  </main>
</Layout>
